version: 0.2

phases:
  install:
    commands:
      - echo "Deploy iniciado"

  build:
    commands:
      - echo "Artefactos presentes:"
      - ls -R .

      - ZIP_PATH=$(find . -name "lambda.zip" | head -n 1)
      - echo "ZIP encontrado $ZIP_PATH"

      - echo "Actualizando Lambda..."
      - aws lambda update-function-code \
          --function-name lambda-go-hola \
          --zip-file fileb://$ZIP_PATH

      - echo "Publicando version..."
      - VERSION=$(aws lambda publish-version --query Version --output text)
      - echo "Version publicada $VERSION"

      - echo "Actualizando alias live..."
      - aws lambda update-alias \
          --function-name lambda-go-hola \
          --name live \
          --function-version $VERSION